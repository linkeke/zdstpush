function zdstPush(host,port){ var websocket; var o = new Object(); o.onmessage=function(fn){ websocket.onmessage = function (evnt) { fn(evnt); }; }; o.onclose = function(evnt){ websocket.onclose = function (evnt) { } }; o.onopen = function(evnt){ websocket.onopen = function (evnt) { }; }; o.onerror = function(evnt){ websocket.onerror = function (evnt) { }; }; o.connection=function(userName,systemType){ if ('WebSocket' in window) { websocket = new WebSocket("ws://"+host+":"+port+"/webSocketServer?userName="+userName+"&systemType="+systemType); } else if ('MozWebSocket' in window) { websocket = new MozWebSocket("ws://"+host+":"+port+"/webSocketServer?userName="+userName+"&systemType="+systemType); } else { websocket = new SockJS("http://"+host+":"+port+"/sockjs/webSocketServer?userName="+userName+"&systemType="+systemType); } }; return o ; }